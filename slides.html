<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tidy Geospatial Networks in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace" />
    <script src="libs/header-attrs-2.2/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tidy Geospatial Networks in R
## Introducing the <code>sfnetworks</code> package
### Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace
### 2020-06-16 (updated: 2020-06-15)

---

class: center, middle






&lt;STYLE type='text/css' scoped&gt;
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
&lt;/STYLE&gt;



## Hello from the team!
.center[
![:scale 20%](https://avatars1.githubusercontent.com/u/26540305?s=400&amp;u=c576e87314499815cbf698b7781ee58fd1d773e2&amp;v=4)
![:scale 20%](https://pbs.twimg.com/profile_images/1107610946623754240/BaNA8k1E_400x400.png)
![:scale 20%](https://avatars1.githubusercontent.com/u/22221146?s=400&amp;u=3683a04d3f40823162d6c1ae5c51b6c9a5c0a9a5&amp;v=4)
![:scale 20%](https://avatars2.githubusercontent.com/u/10034237?s=460&amp;u=53193bed2fad4f0808b55a227f99897a8d63ebc2&amp;v=4)
]
--
.center[
what brought us together?
]
---
class: center, middle

## Geospatial Networks

--
.pull-left[
Road networks
![](figs/road_network.png)
]

--
.pull-right[
River networks
![](figs/river_network.png)
]

--

[**spnethack**](https://github.com/sfnetworks/spnethack) organised in Munster, 2019

Building on Luuk's MSc project while Robin was visiting [ifgi](https://www.uni-muenster.de/Geoinformatics/en/) 

Result: [Spatial networks in R with sf and tidygraph](https://www.r-spatial.org/r/2019/09/26/spatial-networks.html) blog post

---

.pull-left-30[
## Geospatial in R

- [\#rspatial](https://twitter.com/search?q=%23rspatial)
- `sf`
- `stars`
- `rgeos`
- `rgdal`
- `tmap`
- `ggmap`
- `mapview`
- ...

]


.pull-right-70[
&lt;img src="slides_files/figure-html/geospatial_r-1.png" width="100%" /&gt;

]
---

.pull-left-30[
## Networks in R

- [statnet](http://statnet.org/)
- `igraph`
- `tidygraph`
- `qgraph`
- `ggraph`
- `visNetwork`
- `networkD3`
- ...
]

.pull-right-70[
&lt;img src="slides_files/figure-html/network_ex-1.png" width="90%" /&gt;
]

---
class: center, middle

# then...

## why a new package?

---

.center[
## why a new package?

![](figs/so_q1.png)
]

---

.center[
## why a new package?

![:scale 80%](figs/gh_q1.png)
]

---

.center[
## why a new package?

![](figs/gh_c1.png)
]

---
class: center
## why a new package?

&lt;center&gt;&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;One of the biggest reasons we still have ArcGIS licenses is for Network Analysis (drive times, service areas etc). Does anyone have &lt;a href="https://twitter.com/hashtag/foss4g?src=hash&amp;amp;ref_src=twsrc%5Etfw"&gt;#foss4g&lt;/a&gt; tools for this they like? Last time we tried pgRouting (yrs ago) it didn&amp;#39;t feel fully formed yet, &lt;a href="https://twitter.com/hashtag/gischat?src=hash&amp;amp;ref_src=twsrc%5Etfw"&gt;#gischat&lt;/a&gt;&lt;/p&gt;&amp;mdash; Zev Ross (@zevross) &lt;a href="https://twitter.com/zevross/status/1089908839816794118?ref_src=twsrc%5Etfw"&gt;January 28, 2019&lt;/a&gt;&lt;/blockquote&gt;&lt;/center&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;

--

...

because open source can always get better!

---
class: center, middle

## What do we propose?

--
.pull-left[
![](https://user-images.githubusercontent.com/520851/34887433-ce1d130e-f7c6-11e7-83fc-d60ad4fae6bd.gif)
]

--

.pull-right[
![:scale 38%](https://raw.githubusercontent.com/thomasp85/tidygraph/master/man/figures/logo.png)
]
--

## `sfnetworks`

The best of both worlds!
---
class: middle

.pull-left-70[
.center[
![:scale 80%](https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/tidyverse_celestial.png)
]
.footnote[
Artwork by [@allison_horst](https://twitter.com/allison_horst)
]
]

.pull-right-30[
### *tidy* workflows
&gt; In tidy data:
1. Each variable forms a column.
2. Each observation forms a row.
3. Each type of observational unit forms a table.

.footnote[
Wickham, H. (2014). Tidy Data. Journal of Statistical Software, 59(10), 1 - 23. doi:http://dx.doi.org/10.18637/jss.v059.i10
]

- Supported by the *tidyverse*

- Allows piping `%&gt;%` structures 

]

---
class: center, middle

.pull-left-70[
![](https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/sf.png)
.footnote[
Artwork by [@allison_horst](https://twitter.com/allison_horst)
]
]

.pull-right-30[

### **`sf` package**

Simple features for R

Spatial vector data (points, lines and polygons)

Compatible with *tidy* workflows

S3 classes
]
---
class: center, middle

.pull-left-70[
![:scale 80%](https://www.r-graph-gallery.com/339-circular-dendrogram-with-ggraph_files/figure-html/thecode8-1.png)
.footnote[
Plot from [R GRaph Gallery](https://www.r-graph-gallery.com/339-circular-dendrogram-with-ggraph.html)
]
]

.pull-right-30[

### **`tidygraph` package**
![:scale 10%](https://avatars3.githubusercontent.com/u/3735184?s=200&amp;v=4)
 Interfaces with [`igraph`](https://igraph.org/r/)  
 
![:scale 8%](https://github.com/tidyverse/dplyr/raw/master/man/figures/logo.png)
 Supports [`dplyr`](https://dplyr.tidyverse.org/) *verbs* 

![:scale 8%](https://raw.githubusercontent.com/thomasp85/tidygraph/master/man/figures/logo.png)
 Introduces new *verbs* specific to network data (e.g. `morph`, `bind_graphs`, `graph_join`)

![:scale 8%](https://github.com/thomasp85/ggraph/raw/master/man/figures/logo.png)
 Allows network visualization via [`ggraph`](https://ggraph.data-imaginist.com/)
]

---
class: center, middle

## So, let's dive in...

---
### Installation 

Install the more stable master branch with:


```r
remotes::install_github("luukvdmeer/sfnetworks")
```

Install the develop branch, where most of the development takes place and where PRs should be directed:


```r
remotes::install_github("luukvdmeer/sfnetworks", ref = "develop")
```

---
## `sfnetwork` data structure

### Philosophy

--

&gt; "... a close approximation of tidyness for relational data is two tidy data frames, one describing the node data and one describing the edge data."

`tidygraph` introduction.

--

&lt;br&gt;
&lt;br&gt;

&gt; “A close approximation of tidyness for relational .orange[*geospatial data*] is two .orange[*sf objects*], one describing the node data and one describing the edge data.”

`sfnetworks` adaption.

---
## `sfnetwork` data structure

### Construction

- Nodes: `sf` object with `POINT` geometries

- Edges: *to* and *from* column with end-points

   + spatially explicit: `sf` object with `LINESTRING` geometries

   + spatially implicit: `data.frame` or `tibble` object

- Same CRS!

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
*p1 = st_point(c(7, 51))
*p2 = st_point(c(7, 52))
*p3 = st_point(c(8, 52))

*st_sfc(
*   p1, p2, p3,
*   crs = 4326
* ) %&gt;% st_sf()
```
]
 
.right-output-toyexample-user[

```
Simple feature collection with 3 features and 0 fields
geometry type:  POINT
dimension:      XY
bbox:           xmin: 7 ymin: 51 xmax: 8 ymax: 52
geographic CRS: WGS 84
      geometry
1 POINT (7 51)
2 POINT (7 52)
3 POINT (8 52)
```
]

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
p1 = st_point(c(7, 51))  
p2 = st_point(c(7, 52))  
p3 = st_point(c(8, 52))  

st_sfc(  
    p1, p2, p3,  
    crs = 4326  
  ) %&gt;% st_sf() -&gt;  
* nodes
```
]
 
.right-output-toyexample-user[

]

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
p1 = st_point(c(7, 51))  
p2 = st_point(c(7, 52))  
p3 = st_point(c(8, 52))  

st_sfc(  
    p1, p2, p3,  
    crs = 4326  
  ) %&gt;% st_sf() -&gt;  
  nodes  

*st_sfc(
* st_cast(st_union(p1,p2), "LINESTRING"),
* st_cast(st_union(p1,p3), "LINESTRING"),
* st_cast(st_union(p2,p3), "LINESTRING"),
* crs = 4326
*) %&gt;% st_sf()
```
]
 
.right-output-toyexample-user[

```
Simple feature collection with 3 features and 0 fields
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 7 ymin: 51 xmax: 8 ymax: 52
geographic CRS: WGS 84
                 geometry
1 LINESTRING (7 51, 7 52)
2 LINESTRING (7 51, 8 52)
3 LINESTRING (7 52, 8 52)
```
]

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
p1 = st_point(c(7, 51))  
p2 = st_point(c(7, 52))  
p3 = st_point(c(8, 52))  

st_sfc(  
    p1, p2, p3,  
    crs = 4326  
  ) %&gt;% st_sf() -&gt;  
  nodes  

st_sfc(  
  st_cast(st_union(p1,p2), "LINESTRING"),  
  st_cast(st_union(p1,p3), "LINESTRING"),  
  st_cast(st_union(p2,p3), "LINESTRING"),  
  crs = 4326  
) %&gt;% st_sf() -&gt;  
* edges
```
]
 
.right-output-toyexample-user[

]

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
p1 = st_point(c(7, 51))  
p2 = st_point(c(7, 52))  
p3 = st_point(c(8, 52))  

st_sfc(  
    p1, p2, p3,  
    crs = 4326  
  ) %&gt;% st_sf() -&gt;  
  nodes  

st_sfc(  
  st_cast(st_union(p1,p2), "LINESTRING"),  
  st_cast(st_union(p1,p3), "LINESTRING"),  
  st_cast(st_union(p2,p3), "LINESTRING"),  
  crs = 4326  
) %&gt;% st_sf() -&gt;  
  edges  

*edges$from = c(1, 1, 2)
*edges$to = c(2, 3, 3)
```
]
 
.right-output-toyexample-user[

]

---
class: split-40
count: false
 

.left-code-toyexample-user[

```r
p1 = st_point(c(7, 51))  
p2 = st_point(c(7, 52))  
p3 = st_point(c(8, 52))  

st_sfc(  
    p1, p2, p3,  
    crs = 4326  
  ) %&gt;% st_sf() -&gt;  
  nodes  

st_sfc(  
  st_cast(st_union(p1,p2), "LINESTRING"),  
  st_cast(st_union(p1,p3), "LINESTRING"),  
  st_cast(st_union(p2,p3), "LINESTRING"),  
  crs = 4326  
) %&gt;% st_sf() -&gt;  
  edges  

edges$from = c(1, 1, 2)  
edges$to = c(2, 3, 3)  

*sfnetwork(nodes, edges, directed = FALSE)
```
]
 
.right-output-toyexample-user[

```
# An sfnetwork with 3 nodes and 3 edges
#
# CRS:  EPSG:4326 
#
# An undirected simple graph with 1 component with spatially explicit edges
#
# Node Data:     3 x 1 (active)
# Geometry type: POINT
# Dimension:     XY
# Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52
     geometry
  &lt;POINT [°]&gt;
1      (7 51)
2      (7 52)
3      (8 52)
#
# Edge Data:     3 x 3
# Geometry type: LINESTRING
# Dimension:     XY
# Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52
   from    to         geometry
  &lt;int&gt; &lt;int&gt; &lt;LINESTRING [°]&gt;
1     1     2     (7 51, 7 52)
2     1     3     (7 51, 8 52)
3     2     3     (7 52, 8 52)
```
]

&lt;style&gt;
.left-code-toyexample-user {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-output-toyexample-user {
  width: 60%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;





---
## `sfnetwork` data structure

### Foreign objects

To convert foreign objects into an `sfnetwork` with `as_sfnetwork`, there are two conditions:

- Object is or can be converted to a `tbl_graph`.

- At least the nodes can be converted to an `sf` object.

--

Or just an `sf` object with `POINT` or `LINESTRING` geometry... but some assumptions are made! 

--

More methods were recently added for `sfNetwork`, `linnet` and `psp` objects!

---

class: split-40
count: false
 

.left-code-object-user[

```r
# `sfnetworks` pre-loaded LINESTRING
# `sf` object for Roxel, NRW, Germany
*roxel
```
]
 
.right-output-object-user[
&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;Simple feature collection with 851 features and 2 fields
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
geographic CRS: WGS 84
&lt;span style='color: #555555;'&gt;# A tibble: 851 x 3&lt;/span&gt;&lt;span&gt;
   name          type                                         geometry
   &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;         &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;                                &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;LINESTRING [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 1&lt;/span&gt;&lt;span&gt; Havixbecker ~ residen~       (7.533722 51.95556, 7.533461 51.95576)
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 2&lt;/span&gt;&lt;span&gt; Pienersallee  seconda~ (7.532442 51.95422, 7.53236 51.95377, 7.532~
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 3&lt;/span&gt;&lt;span&gt; Schulte-Bern~ residen~ (7.532709 51.95209, 7.532823 51.95239, 7.53~
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 4&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            path     (7.540063 51.94468, 7.539696 51.94479, 7.53~
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 5&lt;/span&gt;&lt;span&gt; Welsingheide  residen~        (7.537673 51.9475, 7.537614 51.94562)
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 6&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            footway  (7.543791 51.94733, 7.54369 51.94686, 7.543~
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 7&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            footway         (7.54012 51.94478, 7.539931 51.94514)
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 8&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            path     (7.53822 51.94546, 7.538131 51.94549, 7.538~
&lt;/span&gt;&lt;span style='color: #555555;'&gt; 9&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            track    (7.540063 51.94468, 7.540338 51.94468, 7.54~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;10&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #BB0000;'&gt;NA&lt;/span&gt;&lt;span&gt;            track    (7.5424 51.94599, 7.54205 51.94629, 7.54196~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 841 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;
]

---
class: split-40
count: false
 

.left-code-object-user[

```r
# `sfnetworks` pre-loaded LINESTRING
# `sf` object for Roxel, NRW, Germany
roxel %&gt;%  
# convert to an `sfnetwork` object
* as_sfnetwork()
```
]
 
.right-output-object-user[
&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;&lt;span style='color: #555555;'&gt;# An sfnetwork with&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;701&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;nodes and&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;851&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;edges
#
# CRS: &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;EPSG:4326&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;
#
# A directed multigraph with 14 components with spatially explicit edges
#
# Node Data:     701 x 1 (active)&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: POINT&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
             geometry
          &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt; (7.533722 51.95556)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt; (7.533461 51.95576)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt; (7.532442 51.95422)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;4&lt;/span&gt;&lt;span&gt;  (7.53209 51.95328)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;5&lt;/span&gt;&lt;span&gt; (7.532709 51.95209)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;6&lt;/span&gt;&lt;span&gt; (7.532869 51.95257)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 695 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;#
# Edge Data:     851 x 5&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: LINESTRING&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
   from    to name        type                                geometry
  &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;                       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;LINESTRING [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt;     1     2 Havixbecke~ reside~ (7.533722 51.95556, 7.533461 51.955~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt;     3     4 Pienersall~ second~ (7.532442 51.95422, 7.53236 51.9537~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt;     5     6 Schulte-Be~ reside~ (7.532709 51.95209, 7.532823 51.952~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 848 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;
]

---
class: split-40
count: false
 

.left-code-object-user[

```r
# `sfnetworks` pre-loaded LINESTRING
# `sf` object for Roxel, NRW, Germany
roxel %&gt;%  
# convert to an `sfnetwork` object
  as_sfnetwork() %&gt;%  
* class()
```
]
 
.right-output-object-user[

```
[1] "sfnetwork" "tbl_graph" "igraph"   
```
]

&lt;style&gt;
.left-code-object-user {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-output-object-user {
  width: 60%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;





---
## `sfnetwork` data structure

### Arguments for construction

- directed graph?

- spatially explicit edges?
---

class: split-40
count: false
 

.left-code-sfnetworks_options-non_seq[

```r
roxel %&gt;%  
  as_sfnetwork(  
  )  
```
]
 
.right-output-sfnetworks_options-non_seq[
&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;&lt;span style='color: #555555;'&gt;# An sfnetwork with&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;701&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;nodes and&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;851&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;edges
#
# CRS: &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;EPSG:4326&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;
#
# A directed multigraph with 14 components with spatially explicit edges
#
# Node Data:     701 x 1 (active)&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: POINT&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
             geometry
          &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt; (7.533722 51.95556)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt; (7.533461 51.95576)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt; (7.532442 51.95422)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;4&lt;/span&gt;&lt;span&gt;  (7.53209 51.95328)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;5&lt;/span&gt;&lt;span&gt; (7.532709 51.95209)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;6&lt;/span&gt;&lt;span&gt; (7.532869 51.95257)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 695 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;#
# Edge Data:     851 x 5&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: LINESTRING&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
   from    to name        type                                geometry
  &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;                       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;LINESTRING [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt;     1     2 Havixbecke~ reside~ (7.533722 51.95556, 7.533461 51.955~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt;     3     4 Pienersall~ second~ (7.532442 51.95422, 7.53236 51.9537~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt;     5     6 Schulte-Be~ reside~ (7.532709 51.95209, 7.532823 51.952~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 848 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;
]

---
class: split-40
count: false
 

.left-code-sfnetworks_options-non_seq[

```r
roxel %&gt;%  
  as_sfnetwork(  
*   directed = F,
  )  
```
]
 
.right-output-sfnetworks_options-non_seq[
&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;&lt;span style='color: #555555;'&gt;# An sfnetwork with&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;701&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;nodes and&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;851&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;edges
#
# CRS: &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;EPSG:4326&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;
#
# An undirected multigraph with 14 components with spatially explicit edges
#
# Node Data:     701 x 1 (active)&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: POINT&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
             geometry
          &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt; (7.533722 51.95556)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt; (7.533461 51.95576)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt; (7.532442 51.95422)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;4&lt;/span&gt;&lt;span&gt;  (7.53209 51.95328)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;5&lt;/span&gt;&lt;span&gt; (7.532709 51.95209)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;6&lt;/span&gt;&lt;span&gt; (7.532869 51.95257)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 695 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;#
# Edge Data:     851 x 5&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: LINESTRING&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
   from    to name        type                                geometry
  &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;                       &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;LINESTRING [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt;     1     2 Havixbecke~ reside~ (7.533722 51.95556, 7.533461 51.955~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt;     3     4 Pienersall~ second~ (7.532442 51.95422, 7.53236 51.9537~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt;     5     6 Schulte-Be~ reside~ (7.532709 51.95209, 7.532823 51.952~
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 848 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;
]

---
class: split-40
count: false
 

.left-code-sfnetworks_options-non_seq[

```r
roxel %&gt;%  
  as_sfnetwork(  
    directed = F,  
*   edges_as_lines = F
  )  
```
]
 
.right-output-sfnetworks_options-non_seq[
&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;&lt;span style='color: #555555;'&gt;# An sfnetwork with&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;701&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;nodes and&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;851&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;edges
#
# CRS: &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;EPSG:4326&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;'&gt;
#
# An undirected multigraph with 14 components with spatially implicit edges
#
# Node Data:     701 x 1 (active)&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Geometry type: POINT&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Dimension:     XY&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612&lt;/span&gt;&lt;span&gt;
             geometry
          &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt; (7.533722 51.95556)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt; (7.533461 51.95576)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt; (7.532442 51.95422)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;4&lt;/span&gt;&lt;span&gt;  (7.53209 51.95328)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;5&lt;/span&gt;&lt;span&gt; (7.532709 51.95209)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;6&lt;/span&gt;&lt;span&gt; (7.532869 51.95257)
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 695 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;span style='color: #555555;'&gt;#
# Edge Data: 851 x 4&lt;/span&gt;&lt;span&gt;
   from    to name                  type       
  &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;int&amp;gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;                 &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;fct&amp;gt;&lt;/span&gt;&lt;span&gt;      
&lt;/span&gt;&lt;span style='color: #555555;'&gt;1&lt;/span&gt;&lt;span&gt;     1     2 Havixbecker Strasse   residential
&lt;/span&gt;&lt;span style='color: #555555;'&gt;2&lt;/span&gt;&lt;span&gt;     3     4 Pienersallee          secondary  
&lt;/span&gt;&lt;span style='color: #555555;'&gt;3&lt;/span&gt;&lt;span&gt;     5     6 Schulte-Bernd-Strasse residential
&lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 848 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;
]

&lt;style&gt;
.left-code-sfnetworks_options-non_seq {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-output-sfnetworks_options-non_seq {
  width: 60%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;





---
## `sfnetwork` data structure

### Arguments for construction

better observed when plotted...

---

class: split-40
count: false
 

.left-code-plot-non_seq[

```r
par(mar = c(1, 1, 1, 1), bg = NA)  
roxel %&gt;%  
  as_sfnetwork(  
    directed = F,  
  ) %&gt;%  
  plot()  
```
]
 
.right-output-plot-non_seq[
&lt;img src="slides_files/figure-html/plot_non_seq_1_output-1.png" width="432" /&gt;
]

---
class: split-40
count: false
 

.left-code-plot-non_seq[

```r
par(mar = c(1, 1, 1, 1), bg = NA)  
roxel %&gt;%  
  as_sfnetwork(  
    directed = F,  
*   edges_as_lines = F
  ) %&gt;%  
  plot()  
```
]
 
.right-output-plot-non_seq[
&lt;img src="slides_files/figure-html/plot_non_seq_2_output-1.png" width="432" /&gt;
]

&lt;style&gt;
.left-code-plot-non_seq {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-output-plot-non_seq {
  width: 60%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;





---
## `sfnetwork` data structure

### Activation and extraction

Same principle as `tidygraph` with the `activate` verb

---
class: split-40
count: false
 

.left-code-activate-user[

```r
*roxel %&gt;%
* as_sfnetwork()
```
]
 
.right-output-activate-user[

```
# An sfnetwork with 701 nodes and 851 edges
#
# CRS:  EPSG:4326 
#
# A directed multigraph with 14 components with spatially explicit edges
#
# Node Data:     701 x 1 (active)
# Geometry type: POINT
# Dimension:     XY
# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612
             geometry
          &lt;POINT [°]&gt;
1 (7.533722 51.95556)
2 (7.533461 51.95576)
3 (7.532442 51.95422)
4  (7.53209 51.95328)
5 (7.532709 51.95209)
6 (7.532869 51.95257)
# ... with 695 more rows
#
# Edge Data:     851 x 5
# Geometry type: LINESTRING
# Dimension:     XY
# Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612
   from    to name        type                                geometry
  &lt;int&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;                       &lt;LINESTRING [°]&gt;
1     1     2 Havixbecke~ reside~ (7.533722 51.95556, 7.533461 51.955~
2     3     4 Pienersall~ second~ (7.532442 51.95422, 7.53236 51.9537~
3     5     6 Schulte-Be~ reside~ (7.532709 51.95209, 7.532823 51.952~
# ... with 848 more rows
```
]

---
class: split-40
count: false
 

.left-code-activate-user[

```r
roxel %&gt;%  
  as_sfnetwork() %&gt;%  
* activate('edges')
```
]
 
.right-output-activate-user[

```
# An sfnetwork with 701 nodes and 851 edges
#
# CRS:  EPSG:4326 
#
# A directed multigraph with 14 components with spatially explicit edges
#
# Edge Data:     851 x 5 (active)
# Geometry type: LINESTRING
# Dimension:     XY
# Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612
   from    to name       type                                 geometry
  &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;fct&gt;                        &lt;LINESTRING [°]&gt;
1     1     2 Havixbeck~ reside~ (7.533722 51.95556, 7.533461 51.9557~
2     3     4 Pienersal~ second~ (7.532442 51.95422, 7.53236 51.95377~
3     5     6 Schulte-B~ reside~ (7.532709 51.95209, 7.532823 51.9523~
4     7     8 &lt;NA&gt;       path    (7.540063 51.94468, 7.539696 51.9447~
5     9    10 Welsinghe~ reside~ (7.537673 51.9475, 7.537614 51.94562)
6    11    12 &lt;NA&gt;       footway (7.543791 51.94733, 7.54369 51.94686~
# ... with 845 more rows
#
# Node Data:     701 x 1
# Geometry type: POINT
# Dimension:     XY
# Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax:
#   51.9612
             geometry
          &lt;POINT [°]&gt;
1 (7.533722 51.95556)
2 (7.533461 51.95576)
3 (7.532442 51.95422)
# ... with 698 more rows
```
]

---
class: split-40
count: false
 

.left-code-activate-user[

```r
roxel %&gt;%  
  as_sfnetwork() %&gt;%  
  activate('edges')  %&gt;%  
* st_as_sf()
```
]
 
.right-output-activate-user[

```
Simple feature collection with 851 features and 4 fields
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
geographic CRS: WGS 84
# A tibble: 851 x 5
    from    to name       type                                geometry
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;fct&gt;                       &lt;LINESTRING [°]&gt;
 1     1     2 Havixbeck~ reside~ (7.533722 51.95556, 7.533461 51.955~
 2     3     4 Pienersal~ second~ (7.532442 51.95422, 7.53236 51.9537~
 3     5     6 Schulte-B~ reside~ (7.532709 51.95209, 7.532823 51.952~
 4     7     8 &lt;NA&gt;       path    (7.540063 51.94468, 7.539696 51.944~
 5     9    10 Welsinghe~ reside~ (7.537673 51.9475, 7.537614 51.9456~
 6    11    12 &lt;NA&gt;       footway (7.543791 51.94733, 7.54369 51.9468~
 7    13    14 &lt;NA&gt;       footway (7.54012 51.94478, 7.539931 51.9451~
 8     8    10 &lt;NA&gt;       path    (7.53822 51.94546, 7.538131 51.9454~
 9     7    15 &lt;NA&gt;       track   (7.540063 51.94468, 7.540338 51.944~
10    16    17 &lt;NA&gt;       track   (7.5424 51.94599, 7.54205 51.94629,~
# ... with 841 more rows
```
]

---
class: split-40
count: false
 

.left-code-activate-user[

```r
roxel %&gt;%  
  as_sfnetwork() %&gt;%  
  activate('edges')  %&gt;%  
  st_as_sf()  

*roxel %&gt;%
* as_sfnetwork(
*   edges_as_lines = F
* ) %&gt;%
* activate('edges')  %&gt;%
* as_tibble()
```
]
 
.right-output-activate-user[

```
Simple feature collection with 851 features and 4 fields
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
geographic CRS: WGS 84
# A tibble: 851 x 5
    from    to name       type                                geometry
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;fct&gt;                       &lt;LINESTRING [°]&gt;
 1     1     2 Havixbeck~ reside~ (7.533722 51.95556, 7.533461 51.955~
 2     3     4 Pienersal~ second~ (7.532442 51.95422, 7.53236 51.9537~
 3     5     6 Schulte-B~ reside~ (7.532709 51.95209, 7.532823 51.952~
 4     7     8 &lt;NA&gt;       path    (7.540063 51.94468, 7.539696 51.944~
 5     9    10 Welsinghe~ reside~ (7.537673 51.9475, 7.537614 51.9456~
 6    11    12 &lt;NA&gt;       footway (7.543791 51.94733, 7.54369 51.9468~
 7    13    14 &lt;NA&gt;       footway (7.54012 51.94478, 7.539931 51.9451~
 8     8    10 &lt;NA&gt;       path    (7.53822 51.94546, 7.538131 51.9454~
 9     7    15 &lt;NA&gt;       track   (7.540063 51.94468, 7.540338 51.944~
10    16    17 &lt;NA&gt;       track   (7.5424 51.94599, 7.54205 51.94629,~
# ... with 841 more rows
```

```
# A tibble: 851 x 4
    from    to name                  type       
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;                 &lt;fct&gt;      
 1     1     2 Havixbecker Strasse   residential
 2     3     4 Pienersallee          secondary  
 3     5     6 Schulte-Bernd-Strasse residential
 4     7     8 &lt;NA&gt;                  path       
 5     9    10 Welsingheide          residential
 6    11    12 &lt;NA&gt;                  footway    
 7    13    14 &lt;NA&gt;                  footway    
 8     8    10 &lt;NA&gt;                  path       
 9     7    15 &lt;NA&gt;                  track      
10    16    17 &lt;NA&gt;                  track      
# ... with 841 more rows
```
]

&lt;style&gt;
.left-code-activate-user {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-output-activate-user {
  width: 60%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;




---

## What is out there already?

--

- [dodgr](https://atfutures.github.io/dodgr/)

--

- [cppRouting](https://github.com/vlarmet/cppRouting)

--

- [shp2graph](https://r-forge.r-project.org/projects/shp2graph)

--

- [spnetwork](https://github.com/edzer/spnetwork)

--

- [stplanr](https://docs.ropensci.org/stplanr/)

--

- ...

---

background-image: url(https://pbs.twimg.com/media/EZvQNJlWoAE4D_c?format=jpg&amp;name=4096x4096)

# Applications 

--

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;


Many potential applications including:

Transport planning/modelling (Robin), Road safety (Andrea), River network analysis (e.g. Water quality research, Flooding research, Aquatic ecology) Electricity network analysis, Social network analysis, Many More!

---

### How to cope with reduced public transport capacity post COVID-19?

Plans from Leeds City Council responding to national [guidance](https://www.gov.uk/government/publications/reallocating-road-space-in-response-to-covid-19-statutory-guidance-for-local-authorities) and [funding](https://www.gov.uk/government/news/2-billion-package-to-create-new-era-for-cycling-and-walking) for 'pop-up' cycleways:


![](https://pbs.twimg.com/media/EZ_-A0dXgAAlBzt?format=png&amp;name=900x900)

---

## Spatial networks can support planning

### Transport networks are spatial networks

Spatial network representation in R:

![](https://raw.githubusercontent.com/cyipt/popupCycleways/master/figures/mapout.png)



---

background-image: url("https://raw.githubusercontent.com/cyipt/popupCycleways/master/figures/facet-output.png")
background-position: right
background-size: contain

--

### sf + igraph used in project to support investment in 'pop-ups' nationwide

Every city in England

--

Results in Leeds:


```
             name
1 Headingley Lane
2            A660
3  Woodhouse Lane
4             A65
5  Kirkstall Road
```

Cycleway planned for

Kirkstall Road (source: [BBC](https://www.bbc.co.uk/news/uk-england-leeds-52577554))

Free and open results:

[www.cyipt.bike/rapid](https://www.cyipt.bike/rapid)

Source code: [github.com/cyipt/popupCycleways](https://github.com/cyipt/popupCycleways)

&lt;!-- ![](https://raw.githubusercontent.com/cyipt/popupCycleways/master/figures/facet-output.png) --&gt;




---

## Ingredients to prioritise transport infrastructure

.left-column[

- Current travel patterns
- Road attribute data 
- Potential usage levels
- Impact on overall network

**Spatial networks can help, especially with the last two**

Source: https://www.pct.bike/


]

.right-column[

![](figs/pct.png)


]

---

## Why not use `stplanr::SpatialLinesNetwork`?

.pull-left[


- You can:


```r
r_stplanr = stplanr::SpatialLinesNetwork(roxel)
```


```r
l = stplanr::route_local(r_stplanr, c(7.53, 51.95), c(7.54, 51.95))
plot(r_stplanr@sl$geometry)
plot(l$geometry, col = "red", lwd = 5, add = TRUE)
```

&lt;img src="slides_files/figure-html/unnamed-chunk-7-1.png" width="432" /&gt;
]

.pull-right[

Issues with stplanr implementation:

- `igraph` and `sf` parts are separate
- Hard to access the nodes
- Subsetting requires rebuilding the graph


```r
class(r_stplanr)
```

```
[1] "sfNetwork"
attr(,"package")
[1] "stplanr"
```

```r
slotNames(r_stplanr) # s4 class system
```

```
[1] "sl"          "g"           "nb"          "weightfield"
```

]

---

## Statistical analysis of street networks for road safety

Andrea's part

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script src="macro.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
